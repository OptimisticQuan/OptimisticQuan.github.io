---
title: 程序员应该了解的密码学知识
date: 2018-04-24 23:22:07
tags:
- 密码学
- 非对称加密
- 散列函数
- 数字签名
- 数字证书
---
公司内部分享，网上资料整理成文。
### 前言
程序员日常工作和生活中常常会遇到一些比如MD5、iOS的证书、安卓的keystore签名、HTTPS等之类的概念，然后迷迷糊糊，并不清楚这些东西都是干什么的。其实简单了解一些密码学知识，就能很轻松的理解他们是干什么的，他们为什么存在。

<!--more-->

### 正文

#### 加密、解密、秘钥
消息(Message)被称为**明文**。用某种方法伪装消息以隐藏它的内容的过程称为**加密**，加了密的消息称为**密文**(Ciphertext)，而把密文转变为明文的过程称为**解密**。

**加密(Encryption):** E(M) = C
**解密(Decryption):** D(C) = M

仅仅加密解密算法，保密性是不够的。并且不利于标准化和更广泛普遍的使用。所以加入**秘钥**(Key)的概念，大家使用相同的算法，只要秘钥不泄露，就可以实现保密。

带秘钥的加密: E(K, M) = C
带秘钥的解密: D(K, C) = M

#### 对称加密
如果带秘钥的加密和带秘钥的解密中使用的秘钥K是**相同**的，这种算法就被称为**对称加密**。

常用的对称加密算法有DES、AES等。

#### 非对称加密
如果带秘钥的加密和带秘钥的解密中使用的秘钥K是**不同**的，这种算法就被称为**非对称加密**。

常用的对称加密算法有Diffie-Hellman、RSA、ECDH(椭圆曲线Diffie-Hellman密钥协议)等。

非对称加密算法需要两个密钥：公开密钥(publickey) 和私有密钥(privatekey)
公开密钥和私有密钥是一对
如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密。
如果用私有密钥对数据进行加密，只有用对应的公开密钥才能解密。

**非对称加密算法是现代计算机通信安全的基石**。主要依托于数学理论，RSA是数论中两个大质数相乘很难分解。
下边两篇文章，详细讲解了RSA的属性原理
http://www.ruanyifeng.com/blog/2013/06/rsa_algorithm_part_one.html
http://www.ruanyifeng.com/blog/2013/07/rsa_algorithm_part_two.html

如果没听说过的话，一般很难理解加密和解密的key不相同的情形。下面我们就根据RSA算法原理构造一个可以验算的公钥和私钥，进行演示。
p=5 q=11 n=55 Euler(n)=40 e=3 d=27
公钥：n=55 e=3
私钥：n=55 d=27
假设明文：M=2
公钥加密：E = M^e%n = 2^3%55 = 8
私钥解密：M = E^d%n = 8^27%55 = 2

反之
私钥加密：E = M^d%n = 2^27%55 = 18
公钥解密：M = E^e%n = 18^3%55 = 2

但是私钥加密又有什么意义的，因为公钥是公开的，谁都可以拿来解密私钥加密的内容。下文会继续讨论这个问题。

#### 单项散列函数
就是我们日常说的HASH，它是一个多对一函数。这很容易证明，因为值域是有限，而变量定义域是无限的。另外它无法求出反函数，也就是说很难根据结果反推出输入变量。
常用的HASH函数 MD5 SHA CRC
Dictionary Map HashTable
完整性校验：如果HASH结果不相等这两个数据肯定不同，但是如果HASH结果相同，**极大可能**这两个数据相同。由于HASH是单向函数，所以人为的构造出相同HASH结果的数据是极难的。

#### 数字签名
数据 HASH 私钥加密的HASH（数字签名）


#### 数字证书
证明公钥和其拥有者的证书。

证书包含内容：
- 版本：现行通用版本是 V3
- 序号：用以辨识每一张证书，特别在撤消证书的时候有用
- 主体：拥有此证书的法人或自然人身份或机器，包括：
- 国家（C，Country）
- 州/省（S，State）
- 地域/城市（L，Location）
- 组织/单位（O，Organization）
- 通用名称（CN，Common Name）：在TLS应用上，此字段一般是网域
- *发行者：以数字签名形式签署此证书的数字证书认证机构
- 有效期开始时间：此证书的有效开始时间，在此前该证书并未生效
- 有效期结束时间：此证书的有效结束时间，在此后该证书作废
- 公开密钥用途：指定证书上公钥的用途，例如数字签名、服务器验证、客户端验证等
- *公开密钥
- 公开密钥指纹
- 数字签名算法
- 主体别名
- *数字签名

数字证书是一个信任链，直到根证书。根证书一般是预安装在软件中。


### 常见应用
**应用程序签名**： Win iOS Android，保证作者也就是私钥持有者对程序的负责，并且保证程序的完整性。

**HTTPS**： SSL上的HTTP。解决的问题：网站服务商身份鉴别，保证数据加密传输，并且不会被中间人窃听。
**SSL流程：**
- 第一步，爱丽丝给出协议版本号、一个客户端生成的随机数（Client random），以及客户端支持的加密方法。
- 第二步，鲍勃确认双方使用的加密方法，并给出数字证书、以及一个服务器生成的随机数（Server random）。
- 第三步，爱丽丝确认数字证书有效，然后生成一个新的随机数（Premaster secret），并使用数字证书中的公钥，加密这个随机数，发给鲍勃。
- 第四步，鲍勃使用自己的私钥，获取爱丽丝发来的随机数（即Premaster secret）。
- 第五步，爱丽丝和鲍勃根据约定的加密方法，使用前面的三个随机数，生成"对话密钥"（session key），用来加密接下来的整个对话过程。

### 当前流行
比特币 挖矿

|数据项|目的|更新时间|大小|
|:-|:-|:-|:-|
|Version 版本|区域版本号|更新软件后，它指定了一个新版本号|4|
|hashPrevBlock 前一区块的HASH|前一区块的256位HASH值|新的区块进来时|32|
|hashMerkleRootMerkele 根节点HASH值|基于一个区块中所有交易的256位HASH值。|接受一个交易时|32|
|Time 时间戳|从1970-01-01 00:00 UTC开始到现在，以秒为单位的当前时间戳|每几秒就更新|4|
|Bits 当前目标HASH值|压缩格式的当前目标HASH值|当挖矿难度调整时|4|
|Nonce 随机数|从0开始的32位随机|产生HASH时A (每次产生HASH随机数要增长)|4|

交易
https://blog.csdn.net/jeason29/article/details/51576659